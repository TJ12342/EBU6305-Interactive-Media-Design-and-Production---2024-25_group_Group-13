<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community - Quadratic Equations & Parabolas</title>
    <link rel="stylesheet" href="../common/styles/main.css">
    <link rel="stylesheet" href="../common/styles/dark-mode.css">
    <link rel="stylesheet" href="styles/community.css">
    <script src="../common/scripts/i18n.js" defer></script>
</head>
<body>
    <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
    <header>
        <div class="logo">
            <h1 data-i18n="nav.home">Quadratic Equations & Parabolas</h1>
        </div>
        <nav>
            <ul>
                <li><a href="../../index.html" data-i18n="nav.home">Home</a></li>
                <li><a href="../learning/learning.html" data-i18n="nav.learning">Learning</a></li>
                <li><a href="../game/game.html" data-i18n="nav.game">Games</a></li>
                <li><a href="../test/test.html" data-i18n="nav.test">Tests</a></li>
                <li><a href="community.html" class="active" data-i18n="nav.community">Community</a></li>
            </ul>
        </nav>
        <!-- ÊöóÈªëÊ®°ÂºèÂàáÊç¢ -->
        <div class="dark-mode-toggle">
            <button id="dark-mode-btn" data-i18n="common.darkMode">Toggle Dark Mode</button>
        </div>
        <!-- ËØ≠Ë®ÄÂàáÊç¢ -->
        <div class="language-selector">
            <select id="language">
                <option value="en" data-i18n="common.english">English</option>
                <option value="zh" data-i18n="common.chinese">‰∏≠Êñá</option>
            </select>
        </div>
    </header>

    <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
    <main class="community-container">
        <!-- ÂØºËà™Èù¢ÂåÖÂ±ë -->
        <div class="breadcrumb">
            <a href="../../index.html" data-i18n="nav.home">Home</a> > <span data-i18n="nav.community">Community</span>
        </div>

        <!-- Ê¨¢ËøéÂå∫Âùó -->
        <section class="community-welcome">
            <h2 data-i18n="community.welcome.title">Welcome to the Learning Community</h2>
            <p data-i18n="community.welcome.description">Here, you can share your learning experiences, ask questions, participate in discussions, and interact with other math enthusiasts.</p>
            
            <div class="community-stats">
                <div class="stat-item">
                    <div class="stat-number" id="member-count">1,234</div>
                    <div class="stat-label" data-i18n="community.stats.members">Members</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="active-count">456</div>
                    <div class="stat-label" data-i18n="community.stats.active">Active Today</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="topic-count">789</div>
                    <div class="stat-label" data-i18n="community.stats.topics">Topics</div>
                </div>
            </div>
        </section>

        <!-- Á§æÂå∫‰∏ª‰ΩìÂÜÖÂÆπ -->
        <div class="community-main">
            <!-- ‰æßËæπÊ†è -->
            <aside class="community-sidebar">
                <!-- Áî®Êà∑‰ø°ÊÅØÂç°Áâá -->
                <div class="user-card">
                    <div class="user-avatar">
                        <img src="../assets/images/community/avatar-default.jpg" alt="User Avatar" id="user-avatar">
                    </div>
                    <div class="user-info">
                        <h3 class="user-name" id="user-name">Guest</h3>
                        <p class="user-status" id="login-status"><span data-i18n="community.posting.loginPrompt">Please</span> <a href="#" id="login-link" onclick="document.getElementById('login-modal').classList.remove('hidden'); return false;" data-i18n="community.posting.login">login</a> <span data-i18n="community.posting.participatePrompt">to participate in discussions</span></p>
                    </div>
                    <button id="new-post-btn" disabled data-i18n="community.posting.newPost" onclick="if(currentUser) { document.getElementById('new-topic-modal').classList.remove('hidden'); } else { document.getElementById('login-modal').classList.remove('hidden'); }">Create New Topic</button>
                </div>

                <!-- ÁÉ≠Èó®ËØùÈ¢ò -->
                <div class="hot-topics">
                    <h3 data-i18n="community.hotTopics.title">Hot Topics</h3>
                    <ul id="hot-topics-list">
                        <li><a href="#">How to quickly solve quadratic equations?</a> <span class="topic-heat">üî•</span></li>
                        <li><a href="#">Applications of parabolas in physics</a> <span class="topic-heat">üî•</span></li>
                        <li><a href="#">Quadratic function transformation techniques</a></li>
                        <li><a href="#">Help: How to understand the discriminant?</a></li>
                        <li><a href="#">Sharing my parabola drawing tool</a></li>
                    </ul>
                </div>

                <!-- Á§æÂå∫ËßÑÂàô -->
                <div class="community-rules">
                    <h3 data-i18n="community.rules.title">Community Rules</h3>
                    <ul>
                        <li data-i18n="community.rules.rule1">Respect others, communicate friendly</li>
                        <li data-i18n="community.rules.rule2">Focus on math learning related topics</li>
                        <li data-i18n="community.rules.rule3">Search for similar questions before asking</li>
                        <li data-i18n="community.rules.rule4">Provide detailed explanations when sharing solutions</li>
                    </ul>
                    <a href="#" class="rules-link" data-i18n="community.rules.viewAll">View Complete Rules</a>
                </div>
            </aside>

            <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫ -->
            <div class="community-content">
                <!-- ÂàÜÁ±ªÊ†áÁ≠æ -->
                <div class="topic-categories">
                    <button class="category-btn active" data-category="all" data-i18n="community.categories.all">All</button>
                    <button class="category-btn" data-category="question" data-i18n="community.categories.questions">Questions</button>
                    <button class="category-btn" data-category="share" data-i18n="community.categories.experiences">Experiences</button>
                    <button class="category-btn" data-category="discuss" data-i18n="community.categories.discussions">Discussions</button>
                    <button class="category-btn" data-category="resource" data-i18n="community.categories.resources">Resources</button>
                </div>

                <!-- ÊêúÁ¥¢Ê°Ü -->
                <div class="search-bar">
                    <input type="text" id="community-search" data-i18n-placeholder="community.search.placeholder" placeholder="Search topics...">
                    <button id="search-btn" data-i18n="community.search.button">Search</button>
                </div>

                <!-- ËØùÈ¢òÂàóË°® -->
                <div class="topic-list" id="topic-list">
                    <!-- ÁΩÆÈ°∂ËØùÈ¢ò -->
                    <div class="topic-item pinned">
                        <div class="topic-icon">üìå</div>
                        <div class="topic-content">
                            <h3 class="topic-title"><a href="#">Community Guide: How to Ask and Answer</a></h3>
                            <div class="topic-meta">
                                <span class="topic-category official">Official</span>
                                <span class="topic-author">Author: Admin</span>
                                <span class="topic-time">2025-03-01</span>
                            </div>
                            <p class="topic-preview">This guide introduces how to ask high-quality questions in the community and how to provide helpful answers. Following these suggestions can make our community more efficient and friendly...</p>
                            <div class="topic-stats">
                                <span class="views">üëÅÔ∏è 1024</span>
                                <span class="replies">üí¨ 57</span>
                                <span class="likes">‚ù§Ô∏è 138</span>
                            </div>
                        </div>
                    </div>

                    <!-- ÊôÆÈÄöËØùÈ¢ò -->
                    <div class="topic-item">
                        <div class="topic-icon">‚ùì</div>
                        <div class="topic-content">
                            <h3 class="topic-title"><a href="#">How to understand the discriminant of quadratic functions?</a></h3>
                            <div class="topic-meta">
                                <span class="topic-category question">Question</span>
                                <span class="topic-author">Author: MathEnthusiast</span>
                                <span class="topic-time">2025-03-15</span>
                            </div>
                            <p class="topic-preview">I'm confused about the discriminant Œî=b¬≤-4ac of quadratic functions, especially its relationship with the graph and equation solutions. Could someone explain the geometric meaning of the discriminant in detail...</p>
                            <div class="topic-stats">
                                <span class="views">üëÅÔ∏è 256</span>
                                <span class="replies">üí¨ 12</span>
                                <span class="likes">‚ù§Ô∏è 24</span>
                            </div>
                        </div>
                    </div>

                    <div class="topic-item">
                        <div class="topic-icon">üìù</div>
                        <div class="topic-content">
                            <h3 class="topic-title"><a href="#">Understanding Quadratic Function Transformations</a></h3>
                            <div class="topic-meta">
                                <span class="topic-category share">Experience</span>
                                <span class="topic-author">Author: FunctionMaster</span>
                                <span class="topic-time">2025-03-14</span>
                            </div>
                            <p class="topic-preview">I've summarized a method for understanding quadratic function transformations, including intuitive understanding of translations, stretches, compressions, etc. This approach has helped me solve related problems quickly in exams...</p>
                            <div class="topic-stats">
                                <span class="views">üëÅÔ∏è 320</span>
                                <span class="replies">üí¨ 18</span>
                                <span class="likes">‚ù§Ô∏è 45</span>
                            </div>
                        </div>
                    </div>

                    <div class="topic-item">
                        <div class="topic-icon">üí¨</div>
                        <div class="topic-content">
                            <h3 class="topic-title"><a href="#">Real-world Applications of Parabolas</a></h3>
                            <div class="topic-meta">
                                <span class="topic-category discuss">Discussion</span>
                                <span class="topic-author">Author: PhysicsLover</span>
                                <span class="topic-time">2025-03-12</span>
                            </div>
                            <p class="topic-preview">I've been researching applications of parabolas in the real world and found many interesting examples like bridge design, satellite dishes, fountain water jets, etc. Does anyone know of other application cases for parabolas?</p>
                            <div class="topic-stats">
                                <span class="views">üëÅÔ∏è 185</span>
                                <span class="replies">üí¨ 23</span>
                                <span class="likes">‚ù§Ô∏è 37</span>
                            </div>
                        </div>
                    </div>

                    <div class="topic-item">
                        <div class="topic-icon">üìö</div>
                        <div class="topic-content">
                            <h3 class="topic-title"><a href="#">Sharing an Online Quadratic Equation Solver</a></h3>
                            <div class="topic-meta">
                                <span class="topic-category resource">Resource</span>
                                <span class="topic-author">Author: ToolExpert</span>
                                <span class="topic-time">2025-03-10</span>
                            </div>
                            <p class="topic-preview">I found a great online tool that not only solves quadratic equations but also provides detailed solution steps and graphical analysis. It's very helpful for learning quadratic equations, sharing with everyone...</p>
                            <div class="topic-stats">
                                <span class="views">üëÅÔ∏è 210</span>
                                <span class="replies">üí¨ 8</span>
                                <span class="likes">‚ù§Ô∏è 31</span>
                            </div>
                        </div>
                    </div>

                    <div class="topic-item">
                        <div class="topic-icon">‚ùì</div>
                        <div class="topic-content">
                            <h3 class="topic-title"><a href="#">How to Solve Quadratic Equations with Parameters?</a></h3>
                            <div class="topic-meta">
                                <span class="topic-category question">Question</span>
                                <span class="topic-author">Author: HighSchooler</span>
                                <span class="topic-time">2025-03-08</span>
                            </div>
                            <p class="topic-preview">I've been learning quadratic equations with parameters and encountered some difficult problems. Especially when discussing root conditions for different parameter values, are there any good solving approaches or techniques?</p>
                            <div class="topic-stats">
                                <span class="views">üëÅÔ∏è 167</span>
                                <span class="replies">üí¨ 15</span>
                                <span class="likes">‚ù§Ô∏è 19</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÂàÜÈ°µ -->
                <div class="pagination">
                    <button class="page-btn active">1</button>
                    <button class="page-btn">2</button>
                    <button class="page-btn">3</button>
                    <button class="page-btn">4</button>
                    <button class="page-btn">5</button>
                    <button class="page-btn">...</button>
                    <button class="page-btn">Next ¬ª</button>
                </div>
            </div>
        </div>
    </main>

    <!-- È°µËÑö -->
    <footer>
        <div class="footer-content">
            <div class="footer-contact">
                <h3 data-i18n="common.contact">Contact Us</h3>
                <p data-i18n="common.email">Email: contact@quadraticlearning.com</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p data-i18n="common.copyright">¬© 2025 Quadratic Equations & Parabolas Interactive Learning. All rights reserved.</p>
            <p><a href="../common/privacy.html" data-i18n="common.privacy">Privacy Policy</a> | <a href="../common/terms.html" data-i18n="common.terms">Terms of Use</a></p>
        </div>
    </footer>

    <!-- ÁôªÂΩïÊ®°ÊÄÅÊ°Ü -->
    <div id="login-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="document.getElementById('login-modal').classList.add('hidden');">&times;</span>
            <h2 data-i18n="community.posting.loginTitle">Login</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="username" data-i18n="community.posting.username">Username</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password" data-i18n="community.posting.password">Password</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary" data-i18n="community.posting.loginButton">Login</button>
                <p class="register-link"><span data-i18n="community.posting.noAccount">Don't have an account?</span> <a href="#" id="register-link" data-i18n="community.posting.register">Register</a></p>
            </form>
        </div>
    </div>

    <!-- ÂàõÂª∫Êñ∞ËØùÈ¢òÊ®°ÊÄÅÊ°Ü -->
    <div id="new-topic-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 data-i18n="community.posting.newPost">Create New Topic</h2>
            <form id="new-topic-form">
                <div class="form-group">
                    <label for="topic-title" data-i18n="community.posting.title">Title</label>
                    <input type="text" id="topic-title" required>
                </div>
                <div class="form-group">
                    <label for="topic-category" data-i18n="community.posting.category">Category</label>
                    <select id="topic-category" required>
                        <option value="">Select Category</option>
                        <option value="question" data-i18n="community.categories.questions">Questions</option>
                        <option value="share" data-i18n="community.categories.experiences">Experiences</option>
                        <option value="discuss" data-i18n="community.categories.discussions">Discussions</option>
                        <option value="resource" data-i18n="community.categories.resources">Resources</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="topic-content" data-i18n="community.posting.content">Content</label>
                    <textarea id="topic-content" rows="6" required></textarea>
                </div>
                <div class="form-buttons">
                    <button type="button" class="btn btn-cancel" id="cancel-topic" data-i18n="community.posting.cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-i18n="community.posting.post">Post Topic</button>
                </div>
            </form>
        </div>
    </div>

    <!-- JavaScript Êñá‰ª∂ -->
    <script src="../common/scripts/main.js"></script>
    <script src="../common/scripts/dark-mode.js"></script>
    <script src="scripts/community.js"></script>

    <!-- Á§æÂå∫ÂäüËÉΩÁöÑÊú¨Âú∞Â≠òÂÇ®ËÑöÊú¨ -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log("Community script loaded");
        
        // ÂàùÂßãÂåñÂèòÈáè
        let currentUser = null;
        let communityPosts = [];
        const defaultPosts = [
            {
                id: 1000,
                title: "How to understand the discriminant of quadratic functions?",
                category: "question",
                content: "I'm confused about the discriminant Œî=b¬≤-4ac of quadratic functions, especially its relationship with the graph and equation solutions. Could someone explain the geometric meaning of the discriminant in detail?",
                author: "MathEnthusiast",
                date: "2025-03-15",
                views: 256,
                likes: 24,
                replies: []
            },
            {
                id: 1001,
                title: "Understanding Quadratic Function Transformations",
                category: "share",
                content: "I've summarized a method for understanding quadratic function transformations, including intuitive understanding of translations, stretches, compressions, etc. This approach has helped me solve related problems quickly in exams.",
                author: "FunctionMaster",
                date: "2025-03-14",
                views: 320,
                likes: 45,
                replies: []
            },
            {
                id: 1002,
                title: "Real-world Applications of Parabolas",
                category: "discuss",
                content: "I've been researching applications of parabolas in the real world and found many interesting examples like bridge design, satellite dishes, fountain water jets, etc. Does anyone know of other application cases for parabolas?",
                author: "PhysicsLover",
                date: "2025-03-12",
                views: 185,
                likes: 37,
                replies: []
            },
            {
                id: 1003,
                title: "Sharing an Online Quadratic Equation Solver",
                category: "resource",
                content: "I found a great online tool that not only solves quadratic equations but also provides detailed solution steps and graphical analysis. It's very helpful for learning quadratic equations, sharing with everyone!",
                author: "ToolExpert",
                date: "2025-03-10",
                views: 210,
                likes: 31,
                replies: []
            },
            {
                id: 1004,
                title: "How to Solve Quadratic Equations with Parameters?",
                category: "question",
                content: "I've been learning quadratic equations with parameters and encountered some difficult problems. Especially when discussing root conditions for different parameter values, are there any good solving approaches or techniques?",
                author: "HighSchooler",
                date: "2025-03-08",
                views: 167,
                likes: 19,
                replies: []
            }
        ];

        // DOMÂÖÉÁ¥†ÂºïÁî®
        const loginModal = document.getElementById('login-modal');
        const newPostBtn = document.getElementById('new-post-btn');
        const newTopicModal = document.getElementById('new-topic-modal');
        const newTopicForm = document.getElementById('new-topic-form');
        const loginForm = document.getElementById('login-form');
        const topicList = document.getElementById('topic-list');
        const closeModals = document.querySelectorAll('.close, .close-modal');
        const cancelButton = document.getElementById('cancel-topic');
        const categoryButtons = document.querySelectorAll('.category-btn');

        // ÂàùÂßãÂåñÁ§æÂå∫
        function initCommunity() {
            console.log("Initializing community");
            
            // Á°Æ‰øùÁôªÂΩïÈìæÊé•‰∫ã‰ª∂ÁªëÂÆöÊ≠£Â∏∏Â∑•‰Ωú
            document.querySelectorAll('#login-link, #new-post-btn, .close, .close-modal, #cancel-topic').forEach(el => {
                console.log("Found element to bind event:", el.id || el.className);
            });
            
            // Á°Æ‰øùÁôªÂΩïË°®ÂçïÊèê‰∫§‰∫ã‰ª∂Ê≠£Â∏∏Â∑•‰Ωú
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                console.log("Login form submitted directly");
                
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                if (username && password) {
                    // ÁÆÄÂçïÁôªÂΩïÈÄªËæë
                    currentUser = {
                        username: username,
                        avatar: '../assets/images/community/avatar-default.jpg'
                    };
                    
                    // ‰øùÂ≠òÁî®Êà∑‰ø°ÊÅØ
                    localStorage.setItem('communityUser', JSON.stringify(currentUser));
                    
                    // Êõ¥Êñ∞UI
                    updateUserUI(currentUser);
                    updateStats();
                    
                    // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
                    document.getElementById('login-modal').classList.add('hidden');
                    
                    // Ê∏ÖÁ©∫Ë°®Âçï
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                    
                    console.log("User logged in:", currentUser.username);
                }
            });
            
            // ‰ªélocalStorageËé∑ÂèñÁî®Êà∑Êï∞ÊçÆ
            const savedUser = localStorage.getItem('communityUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    console.log("User loaded:", currentUser);
                    updateUserUI(currentUser);
                } catch (e) {
                    console.error("Error parsing user data:", e);
                    localStorage.removeItem('communityUser');
                }
            }
            
            // ‰ªélocalStorageËé∑ÂèñÂ∏ñÂ≠êÊï∞ÊçÆ
            let savedPosts = localStorage.getItem('communityPosts');
            if (savedPosts) {
                try {
                    communityPosts = JSON.parse(savedPosts);
                    console.log("Posts loaded:", communityPosts.length);
                } catch (e) {
                    console.error("Error parsing posts data:", e);
                    localStorage.removeItem('communityPosts');
                    communityPosts = [...defaultPosts];
                    localStorage.setItem('communityPosts', JSON.stringify(communityPosts));
                }
            } else {
                // Â¶ÇÊûúÊ≤°Êúâ‰øùÂ≠òÁöÑÂ∏ñÂ≠êÔºå‰ΩøÁî®ÈªòËÆ§Â∏ñÂ≠ê
                console.log("Using default posts");
                communityPosts = [...defaultPosts];
                localStorage.setItem('communityPosts', JSON.stringify(communityPosts));
            }
            
            // Ê∏ÖÈô§È°µÈù¢‰∏äÁöÑÈªòËÆ§Â∏ñÂ≠êÔºå‰ª•‰æøÈáçÊñ∞Ê∏≤Êüì
            clearDefaultPosts();
            
            // Ê∏≤ÊüìÂ∏ñÂ≠êÂíåÊõ¥Êñ∞ÁªüËÆ°
            renderPosts();
            updateStats();
            
            // ÁªëÂÆö‰∫ã‰ª∂ÁõëÂê¨Âô®
            bindEventListeners();
        }
        
        // Ê∏ÖÈô§È°µÈù¢‰∏äÁöÑÈªòËÆ§Â∏ñÂ≠êÔºà‰øùÁïôÁΩÆÈ°∂Â∏ñÂ≠êÔºâ
        function clearDefaultPosts() {
            const pinnedPost = topicList.querySelector('.pinned');
            const nonPinnedPosts = topicList.querySelectorAll('.topic-item:not(.pinned)');
            
            // ÁßªÈô§ÈùûÁΩÆÈ°∂Â∏ñÂ≠ê
            nonPinnedPosts.forEach(post => post.remove());
            
            // Â¶ÇÊûúÁΩÆÈ°∂Â∏ñÂ≠êÂ≠òÂú®Ôºå‰øùÁïôÂÆÉ
            if (pinnedPost) {
                topicList.innerHTML = '';
                topicList.appendChild(pinnedPost);
            }
        }

        // Êõ¥Êñ∞Áî®Êà∑ÁïåÈù¢
        function updateUserUI(user) {
            console.log("Updating UI for user:", user ? user.username : "Guest");
            
            const userNameElement = document.getElementById('user-name');
            const loginStatusElement = document.getElementById('login-status');
            
            if (!userNameElement || !loginStatusElement) {
                console.error("Required UI elements not found");
                return;
            }
            
            if (user) {
                // Áî®Êà∑Â∑≤ÁôªÂΩï
                userNameElement.textContent = user.username;
                loginStatusElement.innerHTML = `<span>${user.username}</span> ¬∑ <a href="#" id="logout-link">Logout</a>`;
                newPostBtn.disabled = false;
                
                // Ê∑ªÂä†ÁôªÂá∫‰∫ã‰ª∂ÁõëÂê¨
                const logoutLink = document.getElementById('logout-link');
                if (logoutLink) {
                    logoutLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        logout();
                    });
                }
            } else {
                // Áî®Êà∑Êú™ÁôªÂΩï
                userNameElement.textContent = 'Guest';
                
                const loginPrompt = document.querySelector('[data-i18n="community.posting.loginPrompt"]') ? 
                    document.querySelector('[data-i18n="community.posting.loginPrompt"]').textContent : 'Please';
                const loginText = document.querySelector('[data-i18n="community.posting.login"]') ? 
                    document.querySelector('[data-i18n="community.posting.login"]').textContent : 'login';
                const participateText = document.querySelector('[data-i18n="community.posting.participatePrompt"]') ? 
                    document.querySelector('[data-i18n="community.posting.participatePrompt"]').textContent : 'to participate in discussions';
                
                loginStatusElement.innerHTML = 
                    `<span>${loginPrompt}</span> <a href="#" id="login-link">${loginText}</a> <span>${participateText}</span>`;
                newPostBtn.disabled = true;
                
                // ÁôªÂΩïÈìæÊé•ÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®Â∞ÜÂú®bindEventListenersÂáΩÊï∞‰∏≠ÁªëÂÆö
            }
        }

        // ÁôªÂá∫ÂäüËÉΩ
        function logout() {
            console.log("User logging out");
            currentUser = null;
            localStorage.removeItem('communityUser');
            updateUserUI(null);
            bindEventListeners(); // ÈáçÊñ∞ÁªëÂÆöÁôªÂΩïÈìæÊé•‰∫ã‰ª∂
            updateStats();
        }

        // Ê∏≤ÊüìÂ∏ñÂ≠êÂàóË°®
        function renderPosts() {
            console.log("Rendering posts");
            
            // ‰øùÂ≠òÁΩÆÈ°∂Â∏ñÂ≠ê
            const pinnedPost = topicList.querySelector('.pinned');
            topicList.innerHTML = '';
            
            if (pinnedPost) {
                topicList.appendChild(pinnedPost);
            }
            
            // ÊåâÊó•ÊúüÊéíÂ∫èÂ∏ñÂ≠êÔºàÈôçÂ∫èÔºâ
            communityPosts.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Ê∏≤ÊüìÊØè‰∏™Â∏ñÂ≠ê
            communityPosts.forEach(post => {
                const postElement = createPostElement(post);
                topicList.appendChild(postElement);
            });
            
            // ‰∏∫Â∏ñÂ≠êÊ∑ªÂä†‰∫§‰∫í‰∫ã‰ª∂
            addPostInteractions();
        }
        
        // ‰∏∫Â∏ñÂ≠êÊ∑ªÂä†‰∫§‰∫í‰∫ã‰ª∂
        function addPostInteractions() {
            // Ê∑ªÂä†ÁÇπËµû‰∫ã‰ª∂
            document.querySelectorAll('.topic-item:not(.pinned) .likes').forEach(likeElement => {
                likeElement.style.cursor = 'pointer';
                likeElement.addEventListener('click', function() {
                    const postId = this.closest('.topic-item').dataset.postId;
                    const post = communityPosts.find(p => p.id == postId);
                    
                    if (!post) return;
                    
                    if (currentUser) {
                        post.likes++;
                        updatePostInStorage(post);
                        this.innerHTML = `‚ù§Ô∏è ${post.likes}`;
                    } else {
                        alert('ËØ∑ÂÖàÁôªÂΩïÂêéÂÜçÁÇπËµû');
                        loginModal.classList.remove('hidden');
                    }
                });
            });
            
            // Ê∑ªÂä†ÊµèËßà‰∫ã‰ª∂
            document.querySelectorAll('.topic-item:not(.pinned) .topic-title a').forEach(titleElement => {
                titleElement.addEventListener('click', function(e) {
                    e.preventDefault();
                    const postId = this.closest('.topic-item').dataset.postId;
                    const post = communityPosts.find(p => p.id == postId);
                    
                    if (!post) return;
                    
                    post.views++;
                    updatePostInStorage(post);
                    this.closest('.topic-item').querySelector('.views').innerHTML = `üëÅÔ∏è ${post.views}`;
                    alert(`Êü•ÁúãÂ∏ñÂ≠ê: ${post.title}\n\n${post.content}`);
                });
            });
        }

        // Êõ¥Êñ∞Â∏ñÂ≠êÂà∞Êú¨Âú∞Â≠òÂÇ®
        function updatePostInStorage(post) {
            const postIndex = communityPosts.findIndex(p => p.id == post.id);
            if (postIndex !== -1) {
                communityPosts[postIndex] = post;
                localStorage.setItem('communityPosts', JSON.stringify(communityPosts));
            }
        }

        // ÂàõÂª∫Â∏ñÂ≠êÂÖÉÁ¥†
        function createPostElement(post) {
            const postDiv = document.createElement('div');
            postDiv.className = 'topic-item';
            postDiv.dataset.postId = post.id;
            
            // Ê†πÊçÆÂàÜÁ±ªËÆæÁΩÆÂõæÊ†á
            let icon = 'üí¨';
            if (post.category === 'question') icon = '‚ùì';
            else if (post.category === 'share') icon = 'üìù';
            else if (post.category === 'resource') icon = 'üìö';
            
            postDiv.innerHTML = `
                <div class="topic-icon">${icon}</div>
                <div class="topic-content">
                    <h3 class="topic-title"><a href="#">${post.title}</a></h3>
                    <div class="topic-meta">
                        <span class="topic-category ${post.category}">${getCategoryName(post.category)}</span>
                        <span class="topic-author">Author: ${post.author}</span>
                        <span class="topic-time">${post.date}</span>
                    </div>
                    <p class="topic-preview">${post.content.substring(0, 200)}${post.content.length > 200 ? '...' : ''}</p>
                    <div class="topic-stats">
                        <span class="views">üëÅÔ∏è ${post.views}</span>
                        <span class="replies">üí¨ ${post.replies ? post.replies.length : 0}</span>
                        <span class="likes" style="cursor:pointer;">‚ù§Ô∏è ${post.likes}</span>
                    </div>
                </div>
            `;
            
            return postDiv;
        }

        // Ëé∑ÂèñÂàÜÁ±ªÂêçÁß∞
        function getCategoryName(category) {
            const categories = {
                'question': document.querySelector('[data-i18n="community.categories.questions"]')?.textContent || 'Questions',
                'share': document.querySelector('[data-i18n="community.categories.experiences"]')?.textContent || 'Experiences',
                'discuss': document.querySelector('[data-i18n="community.categories.discussions"]')?.textContent || 'Discussions',
                'resource': document.querySelector('[data-i18n="community.categories.resources"]')?.textContent || 'Resources'
            };
            
            return categories[category] || category;
        }

        // Êõ¥Êñ∞ÁªüËÆ°Êï∞ÊçÆ
        function updateStats() {
            document.getElementById('member-count').textContent = currentUser ? '1,235' : '1,234';
            document.getElementById('active-count').textContent = currentUser ? '457' : '456';
            document.getElementById('topic-count').textContent = communityPosts.length;
        }
        
        // ÁªëÂÆöÊâÄÊúâ‰∫ã‰ª∂ÁõëÂê¨Âô®
        function bindEventListeners() {
            console.log("Binding event listeners");
            
            // ÁªëÂÆöÁôªÂΩïÈìæÊé•‰∫ã‰ª∂
            const loginLink = document.getElementById('login-link');
            if (loginLink) {
                console.log("Login link found, binding click event");
                loginLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log("Login link clicked");
                    loginModal.classList.remove('hidden');
                });
            } else {
                console.warn("Login link not found");
            }
            
            // ÁªëÂÆöÂèëÂ∏ÉÊñ∞Â∏ñÂ≠êÊåâÈíÆ‰∫ã‰ª∂
            newPostBtn.addEventListener('click', function() {
                console.log("New post button clicked");
                if (currentUser) {
                    newTopicModal.classList.remove('hidden');
                } else {
                    loginModal.classList.remove('hidden');
                }
            });
            
            // ÁªëÂÆöÁôªÂΩïË°®ÂçïÊèê‰∫§‰∫ã‰ª∂
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                console.log("Login form submitted");
                
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                if (username && password) {
                    // ÁÆÄÂçïÁôªÂΩïÈÄªËæë
                    currentUser = {
                        username: username,
                        avatar: '../assets/images/community/avatar-default.jpg'
                    };
                    
                    // ‰øùÂ≠òÁî®Êà∑‰ø°ÊÅØ
                    localStorage.setItem('communityUser', JSON.stringify(currentUser));
                    
                    // Êõ¥Êñ∞UI
                    updateUserUI(currentUser);
                    updateStats();
                    
                    // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
                    loginModal.classList.add('hidden');
                    
                    // Ê∏ÖÁ©∫Ë°®Âçï
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                    
                    console.log("User logged in:", currentUser.username);
                }
            });
            
            // ÁªëÂÆöÊñ∞Â∏ñÂ≠êË°®ÂçïÊèê‰∫§‰∫ã‰ª∂
            newTopicForm.addEventListener('submit', function(e) {
                e.preventDefault();
                console.log("New topic form submitted");
                
                if (!currentUser) {
                    alert('ËØ∑ÂÖàÁôªÂΩïÂêéÂÜçÂèëÂ∏ÉËÆ®ËÆ∫');
                    loginModal.classList.remove('hidden');
                    return;
                }
                
                const title = document.getElementById('topic-title').value;
                const category = document.getElementById('topic-category').value;
                const content = document.getElementById('topic-content').value;
                
                if (!title || !category || !content) {
                    alert('ËØ∑Â°´ÂÜôÊâÄÊúâÂ≠óÊÆµ');
                    return;
                }
                
                // ÂàõÂª∫Êñ∞Â∏ñÂ≠ê
                const newPost = {
                    id: Date.now(),
                    title: title,
                    category: category,
                    content: content,
                    author: currentUser.username,
                    date: new Date().toISOString().split('T')[0],
                    views: 0,
                    likes: 0,
                    replies: []
                };
                
                console.log("New post created:", newPost);
                
                // Ê∑ªÂä†Âà∞Â∏ñÂ≠êÂàóË°®
                communityPosts.push(newPost);
                
                // ‰øùÂ≠òÂà∞localStorage
                localStorage.setItem('communityPosts', JSON.stringify(communityPosts));
                
                // ÈáçÊñ∞Ê∏≤ÊüìÂ∏ñÂ≠ê
                renderPosts();
                
                // Êõ¥Êñ∞ÁªüËÆ°
                updateStats();
                
                // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°ÜÂπ∂Ê∏ÖÁ©∫Ë°®Âçï
                newTopicModal.classList.add('hidden');
                document.getElementById('topic-title').value = '';
                document.getElementById('topic-category').value = '';
                document.getElementById('topic-content').value = '';
                
                console.log("New post added and UI updated");
            });
            
            // ÁªëÂÆöÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü‰∫ã‰ª∂
            closeModals.forEach(button => {
                button.addEventListener('click', function() {
                    loginModal.classList.add('hidden');
                    newTopicModal.classList.add('hidden');
                });
            });
            
            // ÁªëÂÆöÂèñÊ∂àÊñ∞Â∏ñÂ≠ê‰∫ã‰ª∂
            cancelButton.addEventListener('click', function() {
                newTopicModal.classList.add('hidden');
            });
            
            // ÁªëÂÆöÂàÜÁ±ªÁ≠õÈÄâ‰∫ã‰ª∂
            categoryButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    
                    // ÁßªÈô§ÊâÄÊúâactiveÁ±ª
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // Ê∑ªÂä†activeÂà∞ÂΩìÂâçÊåâÈíÆ
                    this.classList.add('active');
                    
                    // Á≠õÈÄâÂ∏ñÂ≠ê
                    const topicItems = document.querySelectorAll('.topic-item:not(.pinned)');
                    topicItems.forEach(item => {
                        const itemCategory = item.querySelector('.topic-category');
                        if (category === 'all' || (itemCategory && itemCategory.classList.contains(category))) {
                            item.style.display = 'flex';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            });
            
            // ÁªëÂÆöÊêúÁ¥¢ÂäüËÉΩ
            document.getElementById('search-btn').addEventListener('click', function() {
                const searchText = document.getElementById('community-search').value.toLowerCase();
                if (!searchText) return;
                
                const topicItems = document.querySelectorAll('.topic-item:not(.pinned)');
                topicItems.forEach(item => {
                    const title = item.querySelector('.topic-title').textContent.toLowerCase();
                    const content = item.querySelector('.topic-preview').textContent.toLowerCase();
                    
                    if (title.includes(searchText) || content.includes(searchText)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
                
                // ÈáçÁΩÆÂàÜÁ±ªÊåâÈíÆÁä∂ÊÄÅ
                categoryButtons.forEach(btn => btn.classList.remove('active'));
                document.querySelector('.category-btn[data-category="all"]').classList.add('active');
            });
        }

        // ÂàùÂßãÂåñÁ§æÂå∫
        initCommunity();
    });
    </script>

    <!-- Ê∑ªÂä†È¢ùÂ§ñÁöÑÊ†∑ÂºèÁ°Æ‰øùÊ®°ÊÄÅÊ°ÜÊ≠£Á°ÆÊòæÁ§∫ -->
    <style>
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.7);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }

    .modal:not(.hidden) {
        display: flex;
    }

    .modal-content {
        background-color: #fff;
        padding: 20px;
        border-radius: 5px;
        width: 80%;
        max-width: 500px;
        position: relative;
    }

    .modal.dark-mode .modal-content {
        background-color: #333;
        color: #fff;
    }

    .close, .close-modal {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 24px;
        cursor: pointer;
    }
    </style>
</body>
</html> 